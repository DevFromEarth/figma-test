name: Generate CSS Variables from Tokens

on:
  push:
    paths:
      - 'tokens/**' 

jobs:
  build-tokens:
    runs-on: ubuntu-latest
    
    # NEW: Add permissions block here to grant write access to the GITHUB_TOKEN
    permissions:
      contents: write 

    if: contains(github.event.head_commit.message, 'token') || github.event_name == 'push'
      
    steps:
      # 2.1. Checkout the repository content
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0 

      # ... (Steps 2.2, 2.3, 2.4 remain the same) ...
      - name: ğŸ”¨ Build CSS Variables
        run: npx style-dictionary build --config config.json
      
      # 2.5. Commit the generated CSS file back to the branch where the change originated
      - name: ğŸ“¤ Auto-Commit Generated Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'generated-css/variables.css'
          commit_message: 'ğŸ¨ Chore: Auto-generate CSS variables from token changes on branch ${{ github.ref_name }}'
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
          branch: ${{ github.ref }}