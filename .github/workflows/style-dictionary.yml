name: Generate Design System Variables

# Trigger only on pushes to the 'main' branch
on:
  push:
    branches:
      - main
    # Only run if files inside the 'tokens' directory (or its subdirectories) change.
    paths:
      - 'tokens/**' 

jobs:
  build-tokens:
    runs-on: ubuntu-latest
    
    # CRITICAL: Grant the GITHUB_TOKEN write access for the auto-commit action.
    permissions:
      contents: write 

    steps:
      # Checkout the repository content.
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          # Fetch full history needed for the auto-commit action.
          fetch-depth: 0 

      # Set up Node.js environment.
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # Install project dependencies (Style Dictionary).
      - name: Install Dependencies
        run: npm install 

      # Run Style Dictionary to generate CSS and LESS files based on config.json.
      - name: Build CSS and LESS Variables
        run: npx style-dictionary build --config config.json
      
      # Commit the generated files back to the 'main' branch.
      - name: Auto-Commit Generated Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Target both the CSS and LESS output files.
          file_pattern: 'generated-css/variables.css generated-less/variables.less'
          commit_message: 'ðŸŽ¨ Chore: Auto-generate design tokens (CSS & LESS) on main'
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
          # Target the main branch for the commit.
          branch: main